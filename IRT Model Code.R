#install packages and import libraries
install.packages("mirt")
install.packages("latticeExtra")
library(mirt)
library(shiny)
library(latticeExtra)

itemplot(shiny=T)

#Read data
irt_data <- read.csv('IRT DATA HOH(v2).csv')

#inspect data
head(irt_data)

#filter for items only
item_data <- irt_data[2:9]
head(item_data)

#Rasch Model
poly_model <- mirt(item_data,1,itemtype = 'Rasch')

M2(poly_model, type = "C2", calcNULL = FALSE)

# Fit Indices
for(i in 1:length(item_data)){
  ItemPlot <- itemfit(poly_model, 
                      group.bins=15,
                      empirical.plot = i,
                      empirical.CI = .95,
                      method = 'ML') 
  print(ItemPlot)
}
#Summary of model
summary(poly_model)
#Coefficents of model
irt_coeff <- coef(poly_model, IRTpars = TRUE)
irt_coeff
#curves for the items
plot(poly_model,type="trace")
plot(poly_model,type="infotrace")
#test information curve
plot(poly_model,type="info")
plot(poly_model,type="infoSE")
#itemfit
itemfit(poly_model)
#factor scores
factor_scores = fscores(poly_model)
head(factor_scores)

# Make sure the number of rows in factor_scores matches the number of rows in the original dataset
if (nrow(irt_data) == nrow(factor_scores)) {
  # Add factor scores to the original dataset
  merged_scoring_variable <- cbind(irt_data, factor_scores)
} else {
  # Print an error message if the number of rows doesn't match
  print("Number of rows in factor_scores doesn't match the original dataset.")
}

# Save the merged dataset to a new CSV file
write.csv(merged_scoring_variable, "merged_dataset.csv", row.names = FALSE)
